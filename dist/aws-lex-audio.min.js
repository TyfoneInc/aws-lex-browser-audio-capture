!function o(i,r,a){function s(t,e){if(!r[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=r[t]={exports:{}},i[t][0].call(n.exports,function(e){return s(i[t][1][e]||e)},n,n.exports,o,i,r,a)}return r[t].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,c){!function(){"use strict";var o,i,r,a,n=e("./recorder.js"),s="Audio is not supported.";c.audioControl=function(e){this.checkAudioSupport=!1!==(e=e||{}).checkAudioSupport;e=function(t){t=t||function(){},navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(i=n.audioRecorder()).requestDevice().then(function(e){t(r=!0)}).catch(function(e){t(r=!1)}):t(r=!1)};return this.checkAudioSupport&&e(),{startRecording:function(e,t,n){if(e=e||function(){},t=t||function(){},!(r=!1!==r))throw new Error(s);(o=i.createRecorder(n)).record(e,t)},stopRecording:function(){if(!(r=!1!==r))throw new Error(s);o.stop()},exportWAV:function(e,t){if(!(r=!1!==r))throw new Error(s);if(!e||"function"!=typeof e)throw new Error("You must pass a callback function to export.");o.exportWAV(e,t=void 0!==t?t:16e3),o.clear()},play:function(e,t){var n;void 0!==e&&(n=new Blob([e]),(e=new FileReader).onload=function(){a=i.audioContext().createBufferSource(),i.audioContext().decodeAudioData(this.result,function(e){a.buffer=e,a.connect(i.audioContext().destination),a.onended=function(e){"function"==typeof t&&t()},a.start(0)})},e.readAsArrayBuffer(n))},stop:function(){void 0!==a&&a.stop()},clear:function(){o.clear()},playHtmlAudioElement:function(e,t){var n;void 0!==e&&(e=new Blob([e]),n=document.createElement("audio"),e=window.URL.createObjectURL(e),n.src=e,n.addEventListener("ended",function(){n.currentTime=0,"function"==typeof t&&t()}),n.play())},supportsAudio:e}}}()},{"./recorder.js":4}],2:[function(i,e,r){!function(){"use strict";var a,e=i("./control.js").audioControl,s=Object.freeze({PASSIVE:"Waiting",LISTENING:"Listening",SENDING:"Sending",SPEAKING:"Speaking"}),c=new e({checkAudioSupport:!1});r.conversation=function(e,t,n,o,i){var r;if(this.config=f(e),this.lexConfig=this.config.lexConfig,this.messages=s,t=t||function(){},this.onSuccess=n||function(){},this.onError=o||function(){},this.onAudioData=i||function(){},this.config.lexConfig.botName)if(AWS.config.credentials){if(AWS.config.region){i=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:8a42e098-8c93-4101-877e-0b7682b699c2"});return AWS.config.update({region:"us-east-1",credentials:i}),a=new AWS.LexRuntime,this.onSilence=function(){e.silenceDetection&&(c.stopRecording(),r.advanceConversation())},this.transition=function(e){e=(r=e).state;t(e.message),e.message!==e.messages.SENDING&&e.message!==e.messages.SPEAKING||r.advanceConversation(),e.message!==e.messages.SENDING||this.config.silenceDetection||c.stopRecording()},this.advanceConversation=function(){c.supportsAudio(function(e){e?r.advanceConversation():o("Audio is not supported.")})},this.updateConfig=function(e){this.config=f(e),this.lexConfig=this.config.lexConfig},this.reset=function(){c.clear(),r=new u(r.state)},r=new u(this),{advanceConversation:this.advanceConversation,updateConfig:this.updateConfig,reset:this.reset}}this.onError("A Region value must be provided.")}else this.onError("AWS Credentials must be provided.");else this.onError("A Bot name must be provided.")};var u=function(e){(this.state=e).message=e.messages.PASSIVE,this.advanceConversation=function(){c.startRecording(e.onSilence,e.onAudioData,e.config.silenceDetectionConfig),e.transition(new t(e))}},t=function(t){(this.state=t).message=t.messages.LISTENING,this.advanceConversation=function(){c.exportWAV(function(e){t.audioInput=e,t.transition(new n(t))})}},n=function(n){(this.state=n).message=n.messages.SENDING,this.advanceConversation=function(){n.lexConfig.inputStream=n.audioInput,console.log(n.lexConfig),a.postContent(n.lexConfig,function(e,t){e?(n.onError(e),n.transition(new u(n))):(n.audioOutput=t,n.transition(new o(n)),n.onSuccess(t))})}},o=function(e){(this.state=e).message=e.messages.SPEAKING,this.advanceConversation=function(){"audio/mpeg"===e.audioOutput.contentType?c.play(e.audioOutput.audioStream,function(){"ReadyForFulfillment"!==e.audioOutput.dialogState&&"Fulfilled"!==e.audioOutput.dialogState&&"Failed"!==e.audioOutput.dialogState&&e.config.silenceDetection?(c.startRecording(e.onSilence,e.onAudioData,e.config.silenceDetectionConfig),e.transition(new t(e))):e.transition(new u(e))}):e.transition(new u(e))}},f=function(e){(e=e||{}).silenceDetection=!e.hasOwnProperty("silenceDetection")||e.silenceDetection;var t=e.lexConfig||{};return t.botAlias=t.hasOwnProperty("botAlias")?t.botAlias:"test",t.botName=t.hasOwnProperty("botName")?t.botName:"nFinia",t.contentType=t.hasOwnProperty("contentType")?t.contentType:"audio/x-l16; sample-rate=16000",t.userId=t.hasOwnProperty("userId")?t.userId:"testuser",t.accept=t.hasOwnProperty("accept")?t.accept:"audio/mpeg",e.lexConfig=t,e}}()},{"./control.js":1}],3:[function(t,n,e){!function(e){!function(){e.LexAudio=e.LexAudio||{},e.LexAudio.audioControl=t("./control.js").audioControl,e.LexAudio.conversation=t("./conversation.js").conversation,n.exports=e.LexAudio}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./control.js":1,"./conversation.js":2}],4:[function(e,t,i){!function(){"use strict";function t(e,a){(a=a||{}).time=a.hasOwnProperty("time")?a.time:1500,a.amplitude=a.hasOwnProperty("amplitude")?a.amplitude:.2;var n,s,c,u,o=!1,t=e.context.createScriptProcessor(4096,1,1);function i(){o=!1}r.onmessage=function(e){e=e.data;n(e)},r.postMessage({command:"init",config:{sampleRate:e.context.sampleRate}}),t.onaudioprocess=function(e){o&&(r.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0)]}),function(){f.fftSize=2048;var e=f.fftSize,t=new Uint8Array(e),n=a.amplitude,o=a.time;f.getByteTimeDomainData(t),"function"==typeof u&&u(t,e);for(var i=0;i<e;i++){var r=t[i]/128-1;(n<r||r<-1*n)&&(s=Date.now())}o<Date.now()-s&&c()}())};var f=e.context.createAnalyser();return f.minDecibels=-90,f.maxDecibels=-10,f.smoothingTimeConstant=.85,e.connect(f),f.connect(t),t.connect(e.context.destination),{record:function(e,t){c=e,u=t,s=Date.now(),o=!0},stop:i,clear:function(){i(),r.postMessage({command:"clear"})},exportWAV:function(e,t){n=e,r.postMessage({command:"export",sampleRate:t})}}}var n,o,r=e("webworkify")(e("./worker.js"));i.audioRecorder=function(){return{requestDevice:function(){return void 0===n&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,n=new AudioContext),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){o=e})},createRecorder:function(e){return t(n.createMediaStreamSource(o),e)},audioContext:function(){return n}}}}()},{"./worker.js":5,webworkify:6}],5:[function(e,t,n){t.exports=function(e){"use strict";var f,n=0,o=[];function i(e,t,n){for(var o=0;o<n.length;o++)e.setUint8(t+o,n.charCodeAt(o))}e.addEventListener("message",function(e){switch(e.data.command){case"init":t=e.data.config,f=t.sampleRate;break;case"record":t=e.data.buffer,o.push(t[0]),n+=t[0].length;break;case"export":!function(e){e=function(e){var t=new ArrayBuffer(44+2*e.length),t=new DataView(t);return i(t,0,"RIFF"),t.setUint32(4,32+2*e.length,!0),i(t,8,"WAVE"),i(t,12,"fmt "),t.setUint32(16,16,!0),t.setUint16(20,1,!0),t.setUint16(22,1,!0),t.setUint32(24,f,!0),t.setUint32(28,2*f,!0),t.setUint16(32,2,!0),t.setUint16(34,16,!0),i(t,36,"data"),t.setUint32(40,2*e.length,!0),function(e,t,n){for(var o=0;o<n.length;o++,t+=2){var i=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,i<0?32768*i:32767*i,!0)}}(t,44,e),t}(function(e,t){if(t===f)return e;var n=f/t,t=Math.round(e.length/n),o=new Float32Array(t),i=0,r=0;for(;i<o.length;){for(var a=Math.round((i+1)*n),s=0,c=0,u=r;u<a&&u<e.length;u++)s+=e[u],c++;o[i]=s/c,i++,r=a}return o}(function(e,t){for(var n=new Float32Array(t),o=0,i=0;i<e.length;i++)n.set(e[i],o),o+=e[i].length;return n}(o,n),e)),e=new Blob([e],{type:"application/octet-stream"});postMessage(e)}(e.data.sampleRate);break;case"clear":n=0,o=[]}var t})}},{}],6:[function(e,t,n){var l=arguments[3],p=arguments[4],g=arguments[5],h=JSON.stringify;t.exports=function(e,t){for(var n=Object.keys(g),o=0,i=n.length;o<i;o++){var r=n[o],a=g[r].exports;if(a===e||a&&a.default===e){s=r;break}}if(!s){for(var s=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={},o=0,i=n.length;o<i;o++)c[r=n[o]]=r;p[s]=["function(require,module,exports){"+e+"(self); }",c]}var u=Math.floor(Math.pow(16,8)*Math.random()).toString(16),f={};f[s]=s,p[u]=["function(require,module,exports){var f = require("+h(s)+");(f.default ? f.default : f)(self);}",f];var d={};!function e(t){d[t]=!0;for(var n in p[t][1]){n=p[t][1][n];d[n]||e(n)}}(u);f="("+l+")({"+Object.keys(d).map(function(e){return h(e)+":["+p[e][0]+","+h(p[e][1])+"]"}).join(",")+"},{},["+h(u)+"])",u=window.URL||window.webkitURL||window.mozURL||window.msURL,f=new Blob([f],{type:"text/javascript"});if(t&&t.bare)return f;u=u.createObjectURL(f),f=new Worker(u);return f.objectURL=u,f}},{}]},{},[3]);